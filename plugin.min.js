!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),n=tinymce.util.Tools.resolve("tinymce.util.Tools");t.add("iconfonts",function(t){let o=".fa,.fab,.fal,.far,.fas,.glyphicon,.icon",a=t.getParam("iconfonts_selector",o),i=t.getParam("iconfonts_predefined_cssclass",o),s=a.split(","),l="iconFonts",r="iconfonts",c="mceIconFonts";var u=function(t){return!t},d=function(t){let e=[];return n.isArray(t)&&t.forEach(function(t){void 0!==t.menu?e.push({text:t.title,items:d(t.menu)}):e.push({text:t.title,value:t.value})}),e};let f="i"+s.join(",i"),m=n.isArray(i)?i:u(i)||"link_class_list"!=i?[{text:"None",value:""},{text:"Home",value:"icon icon-home"},]:d(t.getParam("link_class_list",[]));t.on("PreInit",function(){t.schema.addValidElements("i[class|contenteditable]"),t.parser.addNodeFilter("i",g("false")),t.serializer.addNodeFilter("i",g(null)),t.formatter.register(l,{inline:"i",selector:f,remove:"all",split:!0,deep:!0,attributes:{class:"%value"},onmatch:function(t,e,n){return v(t)}})});var g=function(t){return function(e){for(var n=0;n<e.length;n++){var o=e[n];p(o)&&o.attr("contenteditable",t)}}},p=function(t){return v(t)&&!t.firstChild},v=function(t){return console.log("isFontIconNode",t),t&&!u(t.attr("class"))&&h(t.attr("class"))},h=function(t){let e=!1;return t.split(" ").forEach(function(t){e=e||-1!=s.indexOf("."+t)}),e};t.addCommand(c,function(){b(t)});var b=function(t){var e=y(t);t.windowManager.open({title:"Font Icon",size:"normal",body:{type:"panel",items:[{name:"cssclass",type:"input",label:"Class",placeholder:"icon icon-home"},{type:"listbox",name:"predefinedCssclass",label:"Select predefined value",items:m}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0},],initialData:{cssclass:e,predefinedCssclass:""},onSubmit:function(e){M(t,e.getData().cssclass)&&e.close()},onChange:function(t){console.log("dialog.onChange",[t,t.getData()]);let e=t.getData();u(e.predefinedCssclass)||(e.cssclass=e.predefinedCssclass,t.setData(e))}})},y=function(t){var e=C(t);return e?x(e):""},C=function(t){return t.dom.getParent(t.selection.getStart(),f)},x=function(t){return t.getAttribute("class")||""},M=function(t,e){return h(e)?(F(t,e),!0):(t.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1)},F=function(t,e){var n=C(t);n?I(t,e,n):P(t,e),t.focus()},I=function(t,e,n){n.removeAttribute("class"),n.setAttribute("class",e),t.addVisual(),t.undoManager.add()},P=function(t,e){t.undoManager.transact(function(){w(t)||t.selection.collapse(!0),t.selection.isCollapsed()?t.insertContent(t.dom.createHTML("i",{class:e})):(A(t),t.formatter.remove(l,null,null,!0),t.formatter.apply(l,{value:e}),t.addVisual())})},w=function(t){return t.getParam("allow_html_in_font_icon",!1,"boolean")},A=function(t){var o=t.dom;e(o).walk(t.selection.getRng(),function(t){n.each(t,function(t){p(t)&&o.remove(t,!1)})})};return t.ui.registry.addToggleButton(r,{icon:"brightness",tooltip:"Font Icon",onAction:function(){return t.execCommand(c)},onSetup:function(e){return t.selection.selectorChangedWithUnbind(f,e.setActive).unbind}}),t.ui.registry.addMenuItem(r,{icon:"brightness",text:"Font Icon...",onAction:function(){return t.execCommand(c)}}),t.getParam("iconfonts_selector",o),t.ui.registry.addContextMenu(r,{update:function(t){return console.log("iconfont.addContextMenu.update",[t,v(t)]),v(t)?[r]:[]}}),t.on("dblclick",e=>{let n=t.$(e.target);console.log("iconfont.dblclick",[e,e.target,n]),v(n)&&(e.stopPropagation(),t.execCommand(c))}),{getMetadata:()=>({name:"Icon Fonts",url:"https://github.com/thornch/tinymce-iconfonts"})}})}();
